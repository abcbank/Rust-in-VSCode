# 7. 소유권
---
## 7.1. Rust의 메모리 관리
- 시스템은 힙과 스택 두 가지 종류의 메모리를 제어.

- 힙
  - 크기가 일정하지 않은 변수들을 저장하는 공간(class 등)
  - String / Custom Class 등 하나의 객체가 차지하는 공간이 런타임 중에 능동적으로 변해야하는 경우, 아래와 시스템은 메모리를 힙에 저장.
  - 힙에 저장된 메모리는 액세스가 오래 걸리지만, 공간적 제약이 덜하다는 장점이 있음.
  - Class 등이 선언될 경우, 시스템은 스택에 해당 변수의 힙의 위치를 스택에 저장하고, 변수의 유효 데이터는 힙에 저장.
  - 이후 데이터를 액세스할 경우, 스택에서 할당된 힙의 위치를 먼저 참조하고, 그 후 해당 위치로 이동해 변수의 유효 데이터를 읽어옴.

- 스택
  - 크기가 일정한 변수들을 저장하는 공간(스칼라, 튜블, 배열 등)
  - 하나의 객체가 차지하는 공간이 런타임 중에 고정적임.
  - 힘에 저장된 메모리는 액세스가 빠르지만, 반드시 저장할 변수의 크기가 고정적이여야 함.

- 소유권 알고리즘은 스코프 내에서 동작함.
  - 스코프
    - 프로그램 내에서 아이템이 유효함을 표시하기 위한 범위
    - 스코프 밖에 있는 변수는 시스템이 참조할 수 없음.
    ```rust
    // 스코프 외부
    {
        let s = "hello";
        // 스코프 내부
    }
    // 스코프 외부
    // s = "bye"; << 스코프 외부에선 참조 불가능
    ```

- 소유권
  - 하나의 데이터 덩어리에는 하나의 소유권이 있음.
  - 소유권을 보유한 변수를 통해서만 해당 데이터에 액세스 가능
  - 모든 데이터는 스코프가 끝나는 시점에서 모두 데이터 할당이 해제됨.
  - 변수에 값 혹은 다른 변수를 할당할 경우 소유권 이전이 발생하며, 소유권 이전은 힙에 있는 데이터와 스택에 있는 데이터가 처리 방식이 다름.
    - 데이터가 힙에 있는 경우
      - 변수에 값 혹은 다른 변수를 할당할 경우, 할당된 변수는 할당한 변수의 소유권을 가져옴.
      - 힙에 추가적인 데이터 할당은 되지 않으며, 스택에 기존 데이터에 위치를 저장.
      - 이후 할당한 변수는 힙에 있는 데이터에 대한 소유권이 없으므로 데이터 액세스 불가능.
      - 할당한 변수의 소유권을 유지하고 싶은 경우, 해당 변수를 복사 후 복사본을 할당하는 방식으로 진행해야함.

    - 데이터가 스택에 있는 경우
      - 변수에 값 혹은 다른 변수를 할당할 경우, 자동으로 할당한 변수를 복사 후 대입함.
      - 따라서 소유권의 변경은 없으며 이에 따라 할당한 변수 또한 자유롭게 사용 가능.

- 함수와 소유권
  - 소유권은 변수를 함수의 파라미터에 대입할 때도 동일하게 적용됨.
  - 따라서 class 등의 변수를 함수의 파라미터로 활용할 땐 주의를 기울여야 함.

## 7.2. 참조자와 빌림 / 슬라이스
- 위와 같은 소유권에 따른 변수의 비활성화를 보완하기 위해, 여러 방식의 참조를 지원
- 대표적으로 참조자(reference)와 슬라이스(Slice) 활용

### 7.2.1. 참조자(reference)
- 일반 변수를 매개변수를 건네줄 경우, 해당 변수는 함수가 종료되는 시점에서 할당이 해제되므로 이후에 해당 변수를 사용할 수 없음.
- 일반 변수 대신 일반 변수의 포인터를 매개 변수로 건네주는 경우, 소유권의 변화 없이 해당 변수를 참조할 수 있음.
- 함수 내에선 매개변수를 통해 전달된 포인터를 통해 매개변수의 스택으로 접근하고, 매개변수의 스택을 통해 매개변수의 힙 데이터로 접속.
- 이러한 방식을 참조자(reference)를 통한 빌림(borrowing)이라고 말함.
- 참조자 또한 mut를 통해 불변 참조자/가변 참조자를 분류해서 사용
  - 두 개 이상의 가변 참조자가 서로 데이터를 바꾸려고 시도하는 경우를 방지하기 위해, 하나의 변수에 대한 가변 참조자는 스코프 내에서 하나만 사용 가능
  - 불변 참조자를 만들었을 경우, 스코프 내에서 가변 참조자 사용 불가능.
    ```
                  |-----------------------------|
    |-------------|-------------|  --> values   |
    |      a      |    b        |  |   [0: h]   |
    |     ptr  ---|-> ptr ------|---   [1: i]   |
    |-------------|-------------|               |
                  |-----------------------------|
    ```

## 7.2.2. 슬라이스(Slice)
- n 이상, m 미만의 연속된 범위를 의미함.
- 0번째부터 시작할 경우 앞의 숫자를 생략 가능하며, 마지막까지 읽을 경우 마지막 숫자를 생략 가능하다.
- 